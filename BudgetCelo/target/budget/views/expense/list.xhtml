<?xml version="1.0" encoding="ISO-8859-1" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:f="http://java.sun.com/jsf/core">
<ui:composition>
	<h:form id="listExpensesForm">
		<p:growl autoUpdate="true"/>
		<p:panel styleClass="sectionPanel" toggleable="true" rendered="#{monthlyBudgetController.isMonthlyBudgetValid()}">
			<f:facet name="header">
				<span class="panelHeader"> Expenses </span>
			</f:facet>

			<div id="actions">
				<div style="float: left;">
					<h:panelGrid columns="3">
						<p:commandButton value="New"
							onclick="PF('createExpenseDialog').show();" />

						<p:panelGrid id="totalExpenses" columns="2"
							styleClass="seperateGridElements">
							<p:outputLabel value="&nbsp;&nbsp; Total: &nbsp;&nbsp; "
								styleClass="summaryCol" />
							<p:outputLabel id="total" style="color: #{budgetRuleController.textColor(budgetRuleController.rules.get(0))}"
								value="R#{monthlyBudgetController.monthlyBudget.totalExpensesFormated}"
								styleClass="summaryCol" 
								title="#{budgetRuleController.rules.get(0).description} (R#{budgetRuleController.limitPercentageAmount(budgetRuleController.rules.get(0))})"
								rendered="#{visibilityController.showExpenseSensitiveInfo}"/>
							<h:outputText value="#{visibilityController.disguiser()}" 
										rendered="#{visibilityController.showExpenseSensitiveInfo eq false}"
										style="color: #{budgetRuleController.textColor(budgetRuleController.rules.get(0))}" />
						</p:panelGrid>
						
						<p:commandButton value="Add Reccuring" 
										action="#{monthlyBudgetController.addRecurringExpensesFromPreceedingBudget()}"
										id="addReccurring"
										ajax="true"
										update=":listExpensesForm :monthlyBudgetForm :FifthyThirthy20RuleForm"
										rendered="#{monthlyBudgetController.isView() eq false}"
										disabled="#{monthlyBudgetController.moreRecurringExpensesAllowed eq false}"
										styleClass="seperateGridElements"
										title="Get Expenses from a previous Budget that are recurring"
										/>
					</h:panelGrid>
				</div>
				<div style="float: right;">
					<h:panelGrid columns="2">
						<h:outputLabel value="Amounts: &nbsp;" rendered="#{monthlyBudgetController.isView()}"/>
						<p:selectBooleanButton offLabel="Show" onLabel="Hide" rendered="#{monthlyBudgetController.isView()}"
							onIcon="ui-icon-close" offIcon="ui-icon-check">
							<p:ajax listener="#{visibilityController.toggleShowExpenseSensitiveInfo()}" 
									update=":listExpensesForm"
							/>
						</p:selectBooleanButton>
					</h:panelGrid>
				</div>
			</div>
			<br />
			<br />
			<div id="listExpenses">
				<p:dataTable rendered="#{monthlyBudgetController.monthlyBudget.expenses.size() ne 0}"
					value="#{monthlyBudgetController.monthlyBudget.expenses}"
					var="expense" editable="true" 
					rowStyleClass="#{expense.completed ? 'completed' : null}">
					<p:ajax event="rowEdit" update=":listExpensesForm:totalExpenses :monthlyBudgetForm :FifthyThirthy20RuleForm"/>

					<p:column headerText="Name" styleClass="centered" sortBy="#{expense.name}">
						<p:cellEditor>
							<f:facet name="output">
								<h:outputText value="#{expense.name}" rendered="#{visibilityController.showExpenseSensitiveInfo}"/>
								<h:outputText value="#{visibilityController.disguiser()}" rendered="#{visibilityController.showExpenseSensitiveInfo eq false}"/>
							</f:facet>
							<f:facet name="input">
								<h:inputText value="#{expense.name}" styleClass="fillWidthOfParent tableEditInput"/>
							</f:facet>
						</p:cellEditor>
					</p:column>
					<p:column headerText="Amount" styleClass="centered" sortBy="#{expense.amount}">
						<p:cellEditor>
							<f:facet name="output">
								<h:outputText value="R#{expense.amountFormated}" rendered="#{visibilityController.showExpenseSensitiveInfo}"/>
								<h:outputText value="#{visibilityController.disguiser()}" rendered="#{visibilityController.showExpenseSensitiveInfo eq false}"/>
							</f:facet>
							<f:facet name="input">
								<h:inputText value="#{expense.amount}"
									styleClass="fillWidthOfParent tableEditInput" />
							</f:facet>
						</p:cellEditor>
					</p:column>

					<p:column headerText="Type" styleClass="centered" sortBy="#{expense.expenseType.toString()}">
						<p:cellEditor>
							<f:facet name="output">
								<h:outputText value="#{expense.expenseType.toString()}" />
							</f:facet>
							<f:facet name="input">
								<p:selectOneMenu id="type" value="#{expense.expenseType}"
									styleClass="fillWidthOfParent tableEditInput">
									<f:selectItems value="#{expenseController.types}"
										var="typesVar" />
									<p:ajax update="createExpenseForm:save" event="valueChange" />
								</p:selectOneMenu>
							</f:facet>
						</p:cellEditor>
					</p:column>
					<p:column headerText="Necessity" styleClass="centered" sortBy="#{expense.necessityLevel.toString()}">
						<p:cellEditor>
							<f:facet name="output">
								<h:outputText value="#{expense.necessityLevel.toString()}" />
							</f:facet>
							<f:facet name="input">
								<p:selectOneMenu id="necessity" styleClass="fillWidthOfParent tableEditInput"
									value="#{expense.necessityLevel}" required="true"
									requiredMessage="Expense Necessity is required">
									<f:selectItems value="#{expenseController.necessityLevels}" />
								</p:selectOneMenu>
							</f:facet>
						</p:cellEditor>
					</p:column>
					<p:column headerText="Recurring" styleClass="centered" sortBy="#{expense.recurring}" >
						<p:cellEditor>
							<f:facet name="output">
								<h:outputText value="Yes"
									rendered="#{expense.recurring eq true}" />
								<h:outputText value="No"
									rendered="#{expense.recurring eq false}" />
							</f:facet>
							<f:facet name="input">
								<p:selectBooleanCheckbox id="recurring"
									value="#{expense.recurring}"
									styleClass="fillWidthOfParent tableEditInput" />
							</f:facet>
						</p:cellEditor> 
					</p:column>
					<p:column headerText="Completed" styleClass="centered" sortBy="#{expense.completed}">
						<p:cellEditor>
							<f:facet name="output">
								<h:outputText value="Yes"
									rendered="#{expense.completed eq true}" />
								<h:outputText value="No"
									rendered="#{expense.completed eq false}" />
							</f:facet>
							<f:facet name="input">
								<p:selectBooleanCheckbox id="completed"
									value="#{expense.completed}"
									styleClass="fillWidthOfParent tableEditInput" />
							</f:facet>
						</p:cellEditor> 
					</p:column>
					<p:column headerText="Edit" styleClass="optionCol centered">
						<p:rowEditor editTitle="Edit"/>
					</p:column>
					<p:column headerText="Remove" styleClass="optionCol centered"
							  rendered="#{monthlyBudgetController.isView() eq false}">
						<p:commandButton icon="ui-icon-trash"
							update="listExpensesForm :monthlyBudgetForm :FifthyThirthy20RuleForm"
							ajax="true">
							<p:collector unique="false" value="#{expense}"
								removeFrom="#{monthlyBudgetController.monthlyBudget.expenses}" />
						</p:commandButton>
					</p:column>
					<p:column headerText="Options" styleClass="optionCol centered" 
							  rendered="#{monthlyBudgetController.isView()}"
							  title="Show">
						<p:menuButton menuStyleClass="autoWidth">
							<p:menuitem value="Track"
										action="#{expenseTrackerController.initTracker()}"
										title="Track and see your spending on this Expense"
										actionListener="#{expenseTrackerController.createBarChart}"
										>
								<f:setPropertyActionListener value="#{expense}"
									target="#{expenseTrackerController.expense}" />
							</p:menuitem>
							<p:menuitem value="Forecast">
							
							</p:menuitem>
							<p:menuitem value="Remove"
										update="listExpensesForm :monthlyBudgetForm :FifthyThirthy20RuleForm"
										ajax="true"
										>
								<p:collector unique="false" value="#{expense}"
									removeFrom="#{monthlyBudgetController.monthlyBudget.expenses}" />
							</p:menuitem>
						</p:menuButton>
					</p:column>
				</p:dataTable>
			</div>
		</p:panel>
	</h:form>

</ui:composition>

</html>